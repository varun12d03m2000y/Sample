INSERT INTO `vz-it-pr-jffv-inopdo-0.vzw_inopdo_fwa_prd_tbls.format_issues_summary`
(table_name, column_name, issue_type, issue_count, issue_date)

-- Table 1: fwa_mdn_health_check_dly_raw_v1
SELECT 
  'vz-it-pr-137v-ndlpr-0.vzn_ndl_fwa_ssot_core_tbls.fwa_mdn_health_check_dly_raw_v1' AS table_name,
  'mdn' AS column_name,
  issue_type,
  CAST(COUNT(*) AS STRING) AS issue_count,
  trans_dt AS issue_date
FROM `vz-it-pr-137v-ndlpr-0.vzn_ndl_fwa_ssot_core_tbls.fwa_mdn_health_check_dly_raw_v1`
CROSS JOIN UNNEST([
  STRUCT('NULL Value - mdn' AS issue_type, mdn IS NULL),
  STRUCT('Invalid Length - mdn' AS issue_type, LENGTH(REGEXP_REPLACE(mdn, r'^\+?\d{1,3}', '')) NOT IN (10, 11, 12)),
  STRUCT('Empty Value - mdn' AS issue_type, TRIM(mdn) = ''),
  STRUCT('Contains Hyphen - mdn' AS issue_type, mdn LIKE '%-%'),
  STRUCT('Non-Numeric Value - mdn' AS issue_type, SAFE_CAST(REGEXP_REPLACE(mdn, r'^\+?\d{1,3}', '') AS INT64) IS NULL AND mdn != ''),
  STRUCT('Contains Special Characters - mdn' AS issue_type, REGEXP_CONTAINS(REGEXP_REPLACE(mdn, r'^\+?\d{1,3}', ''), '[^0-9]')),
  STRUCT('All Zeros - mdn' AS issue_type, REGEXP_REPLACE(mdn, r'^\+?\d{1,3}', '') = '0000000000'),
  STRUCT('Sequential Pattern - mdn' AS issue_type, REGEXP_REPLACE(mdn, r'^\+?\d{1,3}', '') IN ('1234567890', '9876543210')),
  STRUCT('Repeating Digits - mdn' AS issue_type, REGEXP_CONTAINS(REGEXP_REPLACE(mdn, r'^\+?\d{1,3}', ''), '^(.)\1*$')),
  STRUCT('Invalid Country Code - mdn' AS issue_type, REGEXP_CONTAINS(mdn, r'^\+?\d{1,3}'))
]) 
WHERE trans_dt = CURRENT_DATE() - 2
GROUP BY table_name, column_name, issue_type, trans_dt

UNION ALL

-- Table 2: fixed_fwa_subscriber_fact (mdn, imei, imsi)
SELECT 
  'vz-it-pr-gk1v-cwlspr-0.vzw_uda_prd_tbls.fixed_fwa_subscriber_fact' AS table_name,
  column_name,
  issue_type,
  CAST(COUNT(*) AS STRING) AS issue_count,
  insert_dt AS issue_date
FROM `vz-it-pr-gk1v-cwlspr-0.vzw_uda_prd_tbls.fixed_fwa_subscriber_fact`,
UNNEST(['mdn', 'imei', 'imsi']) AS column_name
CROSS JOIN UNNEST([
  STRUCT('NULL Value' AS issue_type, column_name IS NULL),
  STRUCT('Invalid Length' AS issue_type, LENGTH(column_name) NOT IN (10, 15)),
  STRUCT('Empty Value' AS issue_type, TRIM(column_name) = ''),
  STRUCT('Non-Numeric Value' AS issue_type, SAFE_CAST(column_name AS INT64) IS NULL AND column_name != ''),
  STRUCT('Contains Special Characters' AS issue_type, REGEXP_CONTAINS(column_name, '[^0-9]'))
]) 
WHERE insert_dt = CURRENT_DATE() - 2
GROUP BY table_name, column_name, issue_type, insert_dt

UNION ALL

-- Table 3: fwa_qes_scores (imei)
SELECT 
  'vz-it-pr-fjpv-mlopdo-0.mlops_scores_tbls_v.fwa_qes_scores' AS table_name,
  'imei' AS column_name,
  issue_type,
  CAST(COUNT(*) AS STRING) AS issue_count,
  rpt_dt AS issue_date
FROM `vz-it-pr-fjpv-mlopdo-0.mlops_scores_tbls_v.fwa_qes_scores`
CROSS JOIN UNNEST([
  STRUCT('NULL Value - imei' AS issue_type, imei IS NULL),
  STRUCT('Invalid Length - imei' AS issue_type, LENGTH(imei) NOT IN (15)),
  STRUCT('Empty Value - imei' AS issue_type, TRIM(imei) = ''),
  STRUCT('Non-Numeric Value - imei' AS issue_type, SAFE_CAST(imei AS INT64) IS NULL AND imei != ''),
  STRUCT('Contains Special Characters - imei' AS issue_type, REGEXP_CONTAINS(imei, '[^0-9]'))
]) 
WHERE rpt_dt = CURRENT_DATE() - 2
GROUP BY table_name, column_name, issue_type, rpt_dt

UNION ALL

-- Table 4: fwa_active_customer_performance_daily_norm (mdn)
SELECT 
  'vz-it-pr-gudv-dtwndo-0.aid_dtwin_fwa_core_tbls.fwa_active_customer_performance_daily_norm' AS table_name,
  'mdn' AS column_name,
  issue_type,
  CAST(COUNT(*) AS STRING) AS issue_count,
  trans_dt AS issue_date
FROM `vz-it-pr-gudv-dtwndo-0.aid_dtwin_fwa_core_tbls.fwa_active_customer_performance_daily_norm`
CROSS JOIN UNNEST([
  STRUCT('NULL Value - mdn' AS issue_type, mdn IS NULL),
  STRUCT('Invalid Length - mdn' AS issue_type, LENGTH(mdn) NOT IN (10, 11, 12)),
  STRUCT('Empty Value - mdn' AS issue_type, TRIM(mdn) = ''),
  STRUCT('Contains Hyphen - mdn' AS issue_type, mdn LIKE '%-%'),
  STRUCT('Non-Numeric Value - mdn' AS issue_type, SAFE_CAST(mdn AS INT64) IS NULL AND mdn != ''),
  STRUCT('Contains Special Characters - mdn' AS issue_type, REGEXP_CONTAINS(mdn, '[^0-9]'))
]) 
WHERE trans_dt = CURRENT_DATE() - 2
GROUP BY table_name, column_name, issue_type, trans_dt

UNION ALL

-- Table 5: fixed_5g_dvc_detail (imei, imsi)
SELECT 
  'vz-it-pr-gk1v-cwlspr-0.vzw_uda_prd_tbls.fixed_5g_dvc_detail' AS table_name,
  column_name,
  issue_type,
  CAST(COUNT(*) AS STRING) AS issue_count,
  insert_dt AS issue_date
FROM `vz-it-pr-gk1v-cwlspr-0.vzw_uda_prd_tbls.fixed_5g_dvc_detail`,
UNNEST(['imei', 'imsi']) AS column_name
CROSS JOIN UNNEST([
  STRUCT('NULL Value' AS issue_type, column_name IS NULL),
  STRUCT('Invalid Length' AS issue_type, LENGTH(column_name) NOT IN (15)),
  STRUCT('Empty Value' AS issue_type, TRIM(column_name) = ''),
  STRUCT('Non-Numeric Value' AS issue_type, SAFE_CAST(column_name AS INT64) IS NULL AND column_name != ''),
  STRUCT('Contains Special Characters' AS issue_type, REGEXP_CONTAINS(column_name, '[^0-9]'))
]) 
WHERE insert_dt = CURRENT_DATE() - 2
GROUP BY table_name, column_name, issue_type, insert_dt

UNION ALL

-- Table 6: fwa_combined_inventory_full (no mdn, imei, imsi)
SELECT 
  'vz-it-pr-jffv-inopdo-0.vzw_inopdo_fwa_prd_sec_tbls.fwa_combined_inventory_full' AS table_name,
  NULL AS column_name,
  'No Relevant Columns' AS issue_type,
  '0' AS issue_count,
  CURRENT_DATE() AS issue_date
WHERE TRUE

UNION ALL

-- Table 7: ntwk_nqes_score_model_scores_32 (no mdn, imei, imsi)
SELECT 
  'vz-it-pr-fjpv-mlopdo-0.mlops_scores_tbls_v.ntwk_nqes_score_model_scores_32' AS table_name,
  NULL AS column_name,
  'No Relevant Columns' AS issue_type,
  '0' AS issue_count,
  rpt_dt AS issue_date
FROM `vz-it-pr-fjpv-mlopdo-0.mlops_scores_tbls_v.ntwk_nqes_score_model_scores_32`
WHERE rpt_dt = CURRENT_DATE() - 2;
